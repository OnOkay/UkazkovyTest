<Window x:Class="UkazkovyTest.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:UkazkovyTest.Converters"
        xmlns:local="clr-namespace:UkazkovyTest"
        mc:Ignorable="d"
        Title="Dopisovac" Height="450" Width="800">
    <Window.Resources>
        <conv:BtnValueConverter x:Key="BtnValueConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="5*"/>
            <ColumnDefinition Width="35*"/>
            <ColumnDefinition Width="5*"/>
            <ColumnDefinition Width="60*"/>
            <ColumnDefinition Width="5*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="5*"/>
            <RowDefinition Height="80*"/>
            <RowDefinition Height="10*"/>
            <RowDefinition Height="5*"/>
        </Grid.RowDefinitions>
        <!--Tlačítko bere obsah textboxu a tvoří z něj novou zprávu Zpráva musí být 255>x>0-->
        <!--Upravit cele mozna na menu cast aby se to stackovalo na sebe?-->
        <Button Grid.Column="3" Grid.Row="2" Command ="{Binding SendMessageCommand}" IsEnabled="{Binding CanClickButton}" Name="SendButton" Content="Send" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,50,0"/>
        <TextBox Grid.Column="3" Grid.Row="2" Text="{Binding SendContent, UpdateSourceTrigger=PropertyChanged}" Name="MessageBox" HorizontalAlignment="Left" TextWrapping="Wrap" VerticalAlignment="Center" Height="25" Width="350"/>
        <Label Grid.Column="1" Grid.Row="1" Content="Users" HorizontalAlignment="Center" VerticalAlignment="Top"/>
        <Label Grid.Column="3" Grid.Row="2" Content="{Binding TextLength}" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,25,0"/>
        <Label Grid.Column="3" Grid.Row="2" Content="/ 255" HorizontalAlignment="Right" VerticalAlignment="Center"/>

        <!--Tabule zpráv, vypisuje zprávy 2 aktivních uživatelů-->
        <ListView SelectionMode="Single"
            ItemsSource="{Binding FiltredMessages}" Grid.Column="3" Grid.Row="1">
            <ListView.View>
                <GridView >
                    <GridViewColumn Header="When" DisplayMemberBinding="{Binding SendTime}" />
                    <GridViewColumn Header="Send" DisplayMemberBinding="{Binding Username}" />
                    <GridViewColumn Header="Message" DisplayMemberBinding="{Binding MessageContent}" />
                    <GridViewColumn Header="Seen" DisplayMemberBinding="{Binding ReceiveTime}" />
                </GridView>
            </ListView.View>
        </ListView>

        <!--Seznam uživatelů tlačítek, zapomoci konverteru zobrazují nové zprávy (Uživatel A je chybny) a tlačítkem přemeuje aktivního příjemce-->
        <ScrollViewer Grid.Column="1" Grid.Row="1" Margin="0,25,0,0">
            <ItemsControl ItemsSource="{Binding BtnUsers}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Vertical"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Content="{Binding Username}"
                                Command="{Binding DataContext.ChangeReceiverCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                CommandParameter="{Binding Id}">
                            <Button.Background>
                                <MultiBinding Converter="{StaticResource BtnValueConverter}">
                                    <Binding Path="Id"/>
                                    <Binding Path="DataContext.Messages" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                    <Binding Path="DataContext.ActiveUser" RelativeSource="{RelativeSource AncestorType=Window}"/>
                                </MultiBinding>
                            </Button.Background>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

    </Grid>
</Window>
